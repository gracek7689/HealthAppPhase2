<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="exerciseFunctions.js"></script>

  <title>Health App</title>
</head>

<body>
  <nav class="navbar navbar-expand navbar-light">
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
          <button class="nav-link btn btn-link" id="homeID" onclick="openTab(event, 'Home')">
            <img src="assets/homeIcon.png" />
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link btn btn-link" onclick="openTab(event, 'Food')">
            <img src="assets/foodIcon.png" />
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link btn btn-link" onclick="openTab(event, 'Exercise')">
            <img src="assets/exerciseIcon.png" />
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link btn btn-link" onclick="openTab(event, 'ProfileSettings')">
            <img src="assets/profileSettings.png" />
          </button>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container-fluid">
    <!---------------------------- Home Tab Start: ----------------------------->
    <div id="Home" class="tabcontent home" style="display: block">
      <h1 class="tabHeader"><b>Home</b></h1>
      <div class="container home-container">
        <h2 id="home-date"></h2>
        <br>
        <h3 id="section-title"><b>NUTRITION</b></h3>
        <div class="nutrition-table-container">
          <table class="w3-table w3-hoverable w3-card nutrition-table">
            <thead>
              <tr>
                <th>Nutrition Type</th>
                <th>Total Intake </th>
                <th>Recommended Intake</th>
              </tr>
            </thead>
            <tbody>
              <tr class="parent-nutrient">
                <td id="main-nutrient">Carbohydrate</td>
                <td>189 g</td>
                <td>270 g</td>
              </tr>
              <tr class="child-nutrient carbohydrate">
                <td>Sugars</td>
                <td>16 g</td>
                <td>20 g</td>
              </tr>
              <tr class="child-nutrient carbohydrate">
                <td>Fiber</td>
                <td>17 g</td>
                <td>30 g</td>
              </tr>
              <tr class="child-nutrient carbohydrate">
                <td>Starch</td>
                <td>61 g</td>
                <td>50 g</td>
              </tr>
              <tr class="parent-nutrient">
                <td id="main-nutrient">Protein</td>
                <td>64 g</td>
                <td>100 g</td>
              </tr>
              <tr class="child-nutrient protein">
                <td>TBD</td>
                <td>tbd</td>
                <td>tbd</td>
              </tr>
              <tr class="child-nutrient protein">
                <td>TBD</td>
                <td>tbd</td>
                <td>tbd</td>
              </tr>
              <tr class="parent-nutrient">
                <td id="main-nutrient">Fat</td>
                <td>61 g</td>
                <td>50 g</td>
              </tr>
              <tr class="child-nutrient fat">
                <td>TBD</td>
                <td>tbd</td>
                <td>tbd</td>
              </tr>
              <tr class="child-nutrient fat">
                <td>TBD</td>
                <td>tbd</td>
                <td>tbd</td>
              </tr>
            </tbody>
          </table>
        </div>

        <br>
        <div class="pie-chart-container">
          <canvas id="myChart" style="width:100%"></canvas>
          <!--https://www.chartjs.org/docs/latest/samples/other-charts/multi-series-pie.html-->
          <!-- Not feeling this current pie chart, may need to use this ^^ -->
        </div>

        <br>
        <div class="container calories-table-container">
          <img src="assets/exerciseIcon.png" alt="calories image" id="calories-image">
          <table class="card calories-table">
            <tbody>
              <tr>
                <td>Calories Consumed</td>
                <td>1128 cals</td>
              </tr>
              <tr>
                <td>Recommended Calories</td>
                <td>1800 cals</td>
              </tr>
          </table>
        </div>

        <br>
        <h3 id="section-title"><b>ACTIVITY</b></h3>
        <div class="card activity-container">
          <div class="w3-grey w3-round-large progress-bar">
            <div class="w3-container w3-sand w3-round-large" style="width:25%">25%</div>
          </div>
          <br>
          <div class="container streak-container">
            <img src="assets/exerciseIcon.png" alt="calories image" id="calories-image">
            <div class="card streak-card">
              <h2> Streak: </h2>
              <h2 id="steak-number"> 8 Days</h2>
              <p id="encouragement-message" style="margin: 1%"> Keep going!</p>
            </div>
          </div>
        </div>

      </div>
    </div>
    <!---------------------------- Home Tab End----------------------------->
    <!---------------------------- Food Tab Start: --------------------------->
    <div id="Food" class="tabcontent">
      <h1 class="tabHeader">Nutrition</h1>
      <div class="container mt-5">
        <h2>Enter Custom Food:</h2>
        <div class="row">
          <div class="col-md-4">
            <label for="newItemInput">Name:</label>
            <input type="text" id="newItemInput" class="form-control" oninput="showSuggestions()"
              onkeydown="handleKeyDown(event)" />
          </div>
          <ul id="suggestions"></ul>

          <div class="col-md-4">
            <label for="newItemDesc">Description:</label>
            <input type="text" id="newItemDesc" class="form-control" />
          </div>
          <div class="col-md-4">
            <label for="newItemQty">Quantity:</label>
            <input type="number" id="newItemQty" class="form-control" />
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-md-12">
            <button type="button" class="btn btn-primary" onclick="addItem()">
              Add Item
            </button>
          </div>
        </div>
        <ul class="list-group mt-4 custom-list" id="itemList">
          <li class="list-group-item">
            <button type="button" class="btn btn-danger btn-sm float-right" onclick="removeItem(this)">
              Remove
            </button>
            <div class="row mt-2">
              <div class="col-md-4"><label>Name:</label> Item 1</div>
              <div class="col-md-4">
                <label>Description:</label> Item 1 Description
              </div>
              <div class="col-md-4"><label>Quantity:</label> 1</div>
            </div>
          </li>
          <li class="list-group-item">
            <button type="button" class="btn btn-danger btn-sm float-right" onclick="removeItem(this)">
              Remove
            </button>
            <div class="row mt-2">
              <div class="col-md-4"><label>Name:</label> Apple</div>
              <div class="col-md-4">
                <label>Description:</label> Calories: 90....
              </div>
              <div class="col-md-4"><label>Quantity:</label> 2</div>
            </div>
          </li>
          <li class="list-group-item">
            <button type="button" class="btn btn-danger btn-sm float-right" onclick="removeItem(this)">
              Remove
            </button>
            <div class="row mt-2">
              <div class="col-md-4"><label>Name:</label> Banana</div>
              <div class="col-md-4">
                <label>Description:</label> Calories: 90...
              </div>
              <div class="col-md-4"><label>Quantity:</label> 3</div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <!------------------------- Exercise Tab Start --------------------------->

    <div id="Exercise" class="tabcontent">
      <h1 class="tabHeader">Exercise</h1>

      <section class="exercise">
        <div class="container" id="exerciseContainer">
          <ul class="card-list" id="userExerciseList"></ul>
        </div>
      </section>
    </div>
  </div>

  <!------------------------- Settings Tab Start --------------------------->

  <div id="ProfileSettings" class="tabcontent">
    <h1 class="tabHeaderProfileSettings">Profile Settings</h1>
    <section class="h-100 gradient-custom-2">
      <div class="container py-5 " id="settingsCont" >
        <div class="row d-flex justify-content-center align-items-center h-100">
          <div class="col col-lg-9 col-xl-7">
            <div class="card" style="width: 100%;">
              <div class="card-body p-4 text-black">
                <div class="mb-3">
                  <p class="lead fw-normal mb-1" style="font-size: 2.3rem;">About</p>
                  <div class="p-4" style="background-color: #f8f9fa">
                    <table class="table">
                      <tbody>
                        <tr>
                          <th scope="row" style="width: 50%">Name</th>
                          <td>Jim Kam</td>
                        </tr>
                        <tr>
                          <th scope="row">Fitness Level</th>
                          <td>Advanced</td>
                        </tr>
                        <tr>
                          <th scope="row">Age</th>
                          <td>27 years</td>
                        </tr>
                        <tr>
                          <th scope="row">Current Weight</th>
                          <td>140 lbs</td>
                        </tr>
                        <tr>
                          <th scope="row">Current Height</th>
                          <td>6'3</td>
                        </tr>
                        <tr>
                          <th scope="row">Preferred Workouts</th>
                          <td>
                            <ul class="list-group">
                              <li class="list-group-item">Yoga</li>
                              <li class="list-group-item">Cardio</li>

                            </ul>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <p class="lead fw-normal mb-1" style="font-size: 2.3rem;">Health Goals</p>
                <div class="p-1" style="background-color: #f8f9fa;">
                  <p>Lose 10 pounds by June 23, 2023</p>
                </div>
              </div>
              <button type="button" class="btn btn-outline-dark mx-auto mb-2" data-mdb-ripple-color="dark"
                style="z-index: 1; width: 150px" onclick="editProfile()">

                Edit profile
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <!------------------------- Settings Tab End --------------------------->

  </div>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script>
    let items = [];

     // Represents the different exercises users have entered (including the metrics)
    let userExercises = {
      0: {
        name: "Run",
        weight: false,
        reps: false,
        distance: "3.1 miles",
        duration: "39 min 12 sec",
        time: "8:31 am",
        date: "Wednesday, March 27th"
      },
      1: {
        name: "Yoga",
        weight: false,
        reps: false,
        distance: false,
        duration: "41 min",
        time: "10:40 am",
        date: "Thursday, March 28th"
      },
      2: {
        name: "Curlups",
        weight: "15 lbs",
        reps: "30x",
        distance: false,
        duration: false,
        time: "5:36 pm",
        date: "Friday, March 28th"
      },
    };

    // Represents the different types of exercises and fields associated with them
    let exerciseTypes = {
      "Run": {
        "Weight": false,
        "Reps": false,
        "Distance": true,
        "Duration": true,
        "Time": true,
        "Date": true
      },
      "Yoga": {
        "Weight": false,
        "Reps": false,
        "Distance": false,
        "Duration": true,
        "Time": true,
        "Date": true
      },
      "Curlups": {
        "Weight": true,
        "Reps": true,
        "Distance": false,
        "Duration": false,
        "Time": true,
        "Date": true
      }
    };

    // Make HTTP request to load JSON file for items.json
    let xhr = new XMLHttpRequest();
    xhr.open("GET", "items.json");
    xhr.onload = function () {
      if (xhr.status === 200) {
        // Parse JSON response and store in items array
        items = JSON.parse(xhr.responseText);
      }
    };
    xhr.send();

    document.addEventListener("DOMContentLoaded", function () {
      openTab(event, "Home");
      document.getElementById("homeID").focus();
    });

    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("nav-link");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }
      document.getElementById(tabName).style.display = "block";

      if (tabName === "Exercise") {
        showUserExercises(userExercises, exerciseTypes);
      }
    }

    function editProfile() {
      // Get the container element
      //var container = document.querySelector('.container');
      var container = document.getElementById('settingsCont');

      // Replace the current content with a form
      container.innerHTML = `
      <div id="formContainer">
  <form class="m-3">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" value="Jim Kam" required><br><br>
    <label for="fitnessLevel">Fitness Level:</label>
    <select id="fitnessLevel" name="fitnessLevel">
      <option value="beginner">Beginner</option>
      <option value="intermediate">Intermediate</option>
      <option value="advanced">Advanced</option>
    </select><br><br>
    <label for="age">Age (Years):</label>
    <input type="number" id="age" name="age" value="27" required><br><br>
    <label for="currentWeight">Current Weight (lbs):</label>
    <input type="number" id="currentWeight" name="currentWeight" required><br><br>
    <label for="currentHeight">Current Height (Example format: 6'3):</label>
    <input type="text" id="currentHeight" name="currentHeight" required><br><br>
    <label for="preferredWorkouts">Preferred Workouts:</label><br>
    <input type="checkbox" id="workout1" name="preferredWorkouts" value="Yoga">
    <label for="workout1">Yoga</label><br>
    <input type="checkbox" id="workout2" name="preferredWorkouts" value="Cardio">
    <label for="workout2">Cardio</label><br>
    <input type="checkbox" id="workout3" name="preferredWorkouts" value="Strength Training">
    <label for="workout3">Strength Training</label><br><br>
    <label for="healthGoals">Health Goals:</label>
<select id="healthGoals" name="healthGoals">
  <option value="none">None</option>
  <option value="loseWeight">Lose Weight</option>
  <option value="tone">Tone and Maintain Weight</option>
  <option value="gainWeight">Gain Weight</option>
  <option value="other">Other</option>
</select>
<div id="weightLossFields" style="display: none;">
  <label for="targetWeight">Target Pounds to Lose:</label>
  <input type="number" id="targetWeightLoss" name="targetWeight" required>
  <br><br>
  <label for="targetDate">Target Date:</label>
  <input type="date" id="targetDate" name="targetDate" required>
  <br><br>
</div>
<div id="weightGainFields" style="display: none;">
  <label for="targetWeight">Target Pounds to Gain:</label>
  <input type="number" id="targetWeightGain" name="targetWeight" required>
  <br><br>
  <label for="targetDate">Target Date:</label>
  <input type="date" id="targetDate" name="targetDate" required>
  <br><br>
</div>
<label for="otherHealthGoal" id="instructions" name="otherHealthGoal" style="display:none;">Input other health goal: </label>
<input type="text" id="otherHealthGoal" name="otherHealthGoal" style="display:none;">
<p></p>
<div style="display: flex; justify-content: center;">
  <button type="button" class="btn btn-outline-dark" onclick="saveChanges()">
    Save Changes
  </button>
</div> </form>
</div>
   
  `;
      var healthGoalsSelect = document.getElementById('healthGoals');
      var otherHealthGoalInput = document.getElementById('otherHealthGoal');
      var otherHealthGoal = document.getElementById('instructions');
      var weightLossFields = document.getElementById('weightLossFields');
      var weightGainFields = document.getElementById('weightGainFields');

      healthGoalsSelect.addEventListener('change', function () {
        if (healthGoalsSelect.value == 'other') {
          otherHealthGoalInput.style.display = 'block';
          otherHealthGoal.style.display = 'block';

        } else {
          if (healthGoalsSelect.value == 'loseWeight') {
            weightLossFields.style.display = 'block';


          } else {
            weightLossFields.style.display = 'none';

          }
          if (healthGoalsSelect.value == 'gainWeight') {
            weightGainFields.style.display = 'block';

          } else {
            weightGainFields.style.display = 'none';

          }
          otherHealthGoalInput.style.display = 'none';
          otherHealthGoal.style.display = 'none';

        }
      });


    }

    function saveChanges() {
      // Get the container element
      //var container = document.querySelector('.container');
      var container = document.getElementById('settingsCont');

      // Replace the current content with a form
      container.innerHTML = `
      <section class="h-100 gradient-custom-2">
        <div class="container py-5 h-100">
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-lg-9 col-xl-7">
              <div class="card">
                <div class="card-body p-4 text-black">
                  <div class="mb-3">
                    <p class="lead fw-normal mb-1" style="font-size: 2.3rem;">About</p>
                    <div class="p-4" style="background-color: #f8f9fa;">
                      <table class="table">
                        <tbody>
                          <tr>
                            <th scope="row">Name</th>
                            <td>Jim Kam</td>
                          </tr>
                          <tr>
                            <th scope="row">Fitness Level</th>
                            <td>Advanced</td>
                          </tr>
                          <tr>
                            <th scope="row">Age</th>
                            <td>27 years</td>
                          </tr>
                          <tr>
                            <th scope="row">Current Weight</th>
                            <td>140 lbs</td>
                          </tr>
                          <tr>
                            <th scope="row">Current Height</th>
                            <td>6'3</td>
                          </tr>
                          <tr>
                            <th scope="row">Preferred Workouts</th>
                            <td>
                              <ul class="list-group">
                                <li class="list-group-item">Yoga</li>
                                <li class="list-group-item">Cardio</li>
                              </ul>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <p class="lead fw-normal mb-1" style="font-size: 2.3rem;">Health Goals</p>
                  <div class="p-1" style="background-color: #f8f9fa;">
                    <p>Lose 10 pounds by June 23, 2023</p>
                  </div>
                </div>
                <button type="button" class="btn btn-outline-dark mx-auto mb-2" data-mdb-ripple-color="dark"
                  style="z-index: 1; width: 150px" onclick="editProfile()">
                  Edit profile
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
      `
    }

    function addItem() {
      // Get the input field value
      var newItem = document.getElementById("newItemInput").value;
      var newDescription = document.getElementById("newItemDesc").value;
      var newQty = document.getElementById("newItemQty").value;
      var br = document.createElement("br");
      console.log(newItem);
      // Create a new li element with remove button
      var li = document.createElement("li");
      li.className = "list-group-item";
      li.appendChild(document.createTextNode(newItem));
      li.appendChild(document.createElement("br"));
      li.appendChild(document.createTextNode(newDescription));
      li.appendChild(document.createElement("br"));
      li.appendChild(document.createTextNode(newQty));

      var removeBtn = document.createElement("button");
      removeBtn.className = "btn btn-danger btn-sm float-right";
      removeBtn.appendChild(document.createTextNode("Remove"));
      removeBtn.onclick = function () {
        removeItem(this);
      };
      li.appendChild(removeBtn);

      // Add the new li element to the list
      document.getElementById("itemList").appendChild(li);

      // Clear the input field
      document.getElementById("newItemInput").value = "";
      document.getElementById("newItemDesc").value = "";
      document.getElementById("newItemQty").value = "";
    }

    function removeItem(button) {
      // Get the parent li element
      var li = button.parentNode;

      // Remove the li element from the list
      document.getElementById("itemList").removeChild(li);
    }
    function showSuggestions() {
      let input = document.getElementById("newItemInput");
      let inputValue = input.value.trim().toLowerCase();

      // Get the list of items that match the input value
      let matchingItems = items.filter((item) =>
        item.name.toLowerCase().startsWith(inputValue)
      );

      // Clear the suggestions
      clearSuggestions();

      if (inputValue === "") {
        return;
      }

      if (matchingItems.length === 0) {
        let suggestionsList = document.getElementById("suggestions");
        suggestionsList.style.display = "none";
        return;
      }

      // Add the matching items to the suggestions list
      let suggestionsList = document.getElementById("suggestions");
      suggestionsList.style.display = "block";

      // Position the suggestions list below the input element
      let inputRect = input.getBoundingClientRect();
      suggestionsList.style.left = inputRect.left + "px";
      suggestionsList.style.top = inputRect.bottom + "px";

      matchingItems.forEach((item) => {
        let suggestion = document.createElement("li");
        suggestion.textContent = item.name;
        suggestion.addEventListener("click", () => {
          fillFields(item);
          clearSuggestions();
        });
        suggestionsList.appendChild(suggestion);
      });
    }

    function handleKeyDown(event) {
      let input = document.getElementById("newItemInput");
      let inputValue = input.value;

      // Check for backspace key
      if (event.keyCode === 8 && inputValue.length === 0) {
        clearSuggestions();
      }
    }

    function fillFields(item) {
      let nameField = document.getElementById("newItemInput");
      let descField = document.getElementById("newItemDesc");
      let qtyField = document.getElementById("newItemQty");

      nameField.value = item.name;
      descField.value = item.description;
      qtyField.value = item.quantity;
    }
    function clearSuggestions() {
      let suggestionsList = document.getElementById("suggestions");
      suggestionsList.innerHTML = "";
      suggestionsList.style.display = "none";
    }

    /*******************************/
    /********* HOME PAGE ***********/
    /*******************************/

    // * Rendering dates as needed for our app * //
    const options = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' };
    const currentDate = new Date();
    const formattedDate = currentDate.toLocaleDateString('en-US', options);
    const dateElement = document.getElementById("home-date");
    dateElement.innerText = formattedDate;

    // * Logic to expand and collapse rows on the nutrition table * //
    // Get all the parent rows
    const parentRows = document.querySelectorAll('.parent-nutrient');
    // Loop through each parent row and add a click event listener
    parentRows.forEach(row => {
      row.addEventListener('click', function () {
        // Get the nutrient type of the clicked parent row
        const nutrientType = this.querySelector('td:first-child').innerText.toLowerCase();
        // Get all the child rows that belong to the nutrient type
        const childRows = document.querySelectorAll(`.child-nutrient.${nutrientType}`);
        // Toggle the visibility of the child rows
        childRows.forEach(childRow => {
          childRow.classList.toggle('show');
        });
        this.classList.toggle('expanded');
      });
    });

    // CHARTS //
    var xValues = ["Carbs", "Fats", "Vitamins", "Minerals", "Proteins"];
    var yValues = [55, 49, 44, 24, 15];
    var barColors = ["red", "green", "blue", "orange", "brown"];

    new Chart("myChart", {
      type: "pie",
      data: {
        labels: xValues,
        datasets: [{
          backgroundColor: barColors,
          data: yValues
        }]
      },
      options: {
        title: {
          display: true,
          text: "Total Breakdown of all Nutrients",
          fontSize: 30
        }
      }
    });

  </script>
</body>

</html>