<!---------------------------- Food Tab Start: --------------------------->
<div id="Food" class="tabcontent">
  <h1 class="tabHeader">Nutrition</h1>
  <div class="container mt-5">
    <h2>Enter Food:</h2>
    <div class="row">
      <div class="col-md-4">
        <label for="newItemInput">Name</label>
        <input type="text" id="newItemInput" class="form-control" oninput="showSuggestions()"
          onkeydown="handleKeyDown(event)" style="font-size:28px" required/>
      </div>
      <ul id="suggestions"></ul>
      <div class="col-md-4">
        <label for="newItemCal">Calories</label>
        <input type="number" id="newItemCal" class="form-control" style="font-size:28px" required/>
      </div>
      <div class="col-md-4">
        <label for="newItemQty">Quantity</label>
        <input type="number" id="newItemQty" class="form-control" style="font-size:28px" required/>
      </div>
      <div class="col-md-4">
        <!-- Get an idea of the food -->
        <label for="newItemDesc">Description</label>
        <input type="text" id="newItemDesc" class="form-control" />
      </div>
    </div>
    <div id="moreBoxes" style="display:none;">
      <div class="row mt-3">
        <div class="col-md-4">
          <label for="newItemProtein">Protein:</label>
          <input type="number" id="newItemProtein" class="form-control" />
        </div>
        <div class="col-md-4">
          <label for="newItemFat">Fat:</label>
          <input type="number" id="newItemFat" class="form-control" />
        </div>
        <div class="col-md-4">
          <label for="newItemCarbs">Carbs:</label>
          <input type="number" id="newItemCarbs" class="form-control" />
        </div>
        <div class="col-md-4">
          <label for="newItemVit">Vitamins:</label>
          <input type="number" id="newItemVit" class="form-control" />
        </div>
        <div class="col-md-4">
          <label for="newItemMin">Minerals:</label>
          <input type="number" id="newItemMin" class="form-control" />
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-12">
                  
        <button type="button" class="btn btn-xl btn-primary btn-spacing" onclick="addItem()">
          Add Item
        </button>
        <button type="button" class="btn btn-primary btn-xl btn-danger btn-spacing" onclick="clearForms()">
          Clear
        </button>
        <button type="button" class="btn btn-xl btn-secondary btn-spacing" id="moreBoxesBtn" onclick="toggleMoreBoxes()">More Options</button>
        

      </div>
    </div>
    <ul class="list-group mt-4 custom-list" id="itemList" style="height: 600px; overflow: auto;">
      
    </ul>
  </div>
</div>
<script>
 var foodList = [];
    // Create an XMLHttpRequest object
    var xhs = new XMLHttpRequest();

    // Define the function to be called when the response is received
    xhs.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        // Parse the response text as JSON
        foodList = JSON.parse(this.responseText);

        // Do something with the data
        console.log(foodList);
      }
    };


    function addItem() {
      // Get the input field value
      var newItem = document.getElementById("newItemInput").value;
      var newCal = document.getElementById("newItemCal").value;
      var newDescription = document.getElementById("newItemDesc").value;
      var newQty = document.getElementById("newItemQty").value;
      var br = document.createElement("br");
      console.log("This is a test");
      console.log(newItem);
      if (newItem === "" || newQty === "" || newCal === "") {
        return;
      }
      //Have something like this for protein fats, carbs... and set to 0 if field empty
      // if (newItem === "" || newQty === "" || newCal === "") {
      // return;
      // }
      var newID = Math.random().toString(36).substr(2,9);


      var newItemObject = {
        id:newID,
        name:newItem,
        description: newDescription,
        calories: newCal,
        quantity: newQty ,
      };
      
      foodList.push(newItemObject);
      console.log(foodList);
      // Create a new li element with remove button
      var li = document.createElement("li");
      li.className = "list-group-item";
      li.appendChild(document.createTextNode(newItem));
      li.appendChild(document.createElement("br"));
      li.appendChild(document.createTextNode(newDescription));
      li.appendChild(document.createElement("br"));
      li.appendChild(document.createTextNode("Cals:\t"));
      li.appendChild(document.createTextNode(newCal));
      li.appendChild(document.createElement("br"));
      li.appendChild(document.createTextNode("Quantity:\t"));
      li.appendChild(document.createTextNode(newQty));
      li.setAttribute("data-item-id",newID);
      li.onclick = function() {
        var id = this.getAttribute("data-item-id");
        var item = foodList.find(function(i) {
            return i.id === id;
        });
        if (item) {
            var protein = item.protein || "0";
            var carbs = item.carbs || "0";
            var text = "Protein:\t" + protein + "\nCarbs:\t" + carbs;
            alert(text);
        }
      };
      var removeBtn = document.createElement("button");
      removeBtn.className = "btn btn-danger btn-sm float-right";
      removeBtn.appendChild(document.createTextNode("Remove"));
      removeBtn.onclick = function () {
        removeItem(this);
      };
      li.appendChild(removeBtn);

      // Add the new li element to the list
      document.getElementById("itemList").appendChild(li);

      // Clear the input field
      // document.getElementById("newItemInput").value = "";
      // document.getElementById("newItemDesc").value = "";
      // document.getElementById("newItemQty").value = "";
      // document.getElementById("newItemCal").value = "";
      clearForms();
      localStorage.setItem('foodList',JSON.stringify(foodList));
      var itemList = document.getElementById("itemList");
      itemList.scrollTop = itemList.scrollHeight;
    }
    function removeItem(button) {
      // Get the parent li element
      var li = button.parentNode;

      // Get the ID of the item to remove
      // var itemId = li.getAttribute("data-item-id");
      var itemId = li.getAttribute("data-item-id");
      console.log(itemId);
      console.log(li)
      // Find the index of the item with that ID in the foodList array
      var itemIndex = foodList.findIndex(function (item) {
        return item.id === itemId;
      });

      // If the item was found, remove it from the foodList array
      if (itemIndex !== -1) {
        foodList.splice(itemIndex, 1);
        localStorage.setItem('foodList',JSON.stringify(foodList));
        // fs.writeFileSync("userFood.json", JSON.stringify(data));
      }

      // Remove the li element from the list
      document.getElementById("itemList").removeChild(li);
      console.log("Start");
      console.log(foodList);
      console.log("end");

      // localStorage.setItem('foodList',JSON.stringify(foodList));

    }
    function toggleMoreBoxes() {
      var moreBoxes = document.getElementById("moreBoxes");
      var moreBoxesBtn = document.getElementById("moreBoxesBtn");
      if (moreBoxes.style.display === "none") {
        moreBoxes.style.display = "block";
        moreBoxesBtn.textContent = "Less Options";
      } else {
        moreBoxes.style.display = "none";
        moreBoxesBtn.textContent = "More Options";
      }
    }

    function showSuggestions() {
      let input = document.getElementById("newItemInput");
      let inputValue = input.value.trim().toLowerCase();

      // Get the list of items that match the input value
      let matchingItems = items.filter((item) =>
        item.name.toLowerCase().startsWith(inputValue)
      );

      // Clear the suggestions
      clearSuggestions();

      if (inputValue === "") {
        return;
      }

      if (matchingItems.length === 0) {
        let suggestionsList = document.getElementById("suggestions");
        suggestionsList.style.display = "none";
        return;
      }

      // Add the matching items to the suggestions list
      let suggestionsList = document.getElementById("suggestions");
      suggestionsList.style.display = "block";

      // Position the suggestions list below the input element
      let inputRect = input.getBoundingClientRect();
      suggestionsList.style.left = inputRect.left + "px";
      suggestionsList.style.top = inputRect.bottom + "px";

      matchingItems.forEach((item) => {
        let suggestion = document.createElement("li");
        suggestion.textContent = item.name;
        suggestion.addEventListener("click", () => {
          fillFields(item);
          clearSuggestions();
        });
        suggestionsList.appendChild(suggestion);
      });
    }


    function handleKeyDown(event) {
      let input = document.getElementById("newItemInput");
      let inputValue = input.value;

      // Check for backspace key
      if (event.keyCode === 8 && inputValue.length === 0) {
        clearSuggestions();
      }
    }
    function fillFields(item) {
      let nameField = document.getElementById("newItemInput");
      let descField = document.getElementById("newItemDesc");
      let qtyField = document.getElementById("newItemQty");
      let calField = document.getElementById("newItemCal");

      nameField.value = item.name;
      descField.value = item.description;
      qtyField.value = item.quantity;
      calField.value = item.calories
    }
    function clearSuggestions() {
      let suggestionsList = document.getElementById("suggestions");
      suggestionsList.innerHTML = "";
      suggestionsList.style.display = "none";
    }
    function clearForms(){
      document.getElementById("newItemInput").value = "";
      document.getElementById("newItemDesc").value = "";
      document.getElementById("newItemQty").value = "";
      document.getElementById("newItemCal").value = "";
      document.getElementById("newItemProtein").value = "";
      document.getElementById("newItemFat").value = "";
      document.getElementById("newItemCarbs").value = "";
      document.getElementById("newItemFats").value = "";
      document.getElementById("newItemMinerals").value = "";
      document.getElementById("newItemVitamins").value = "";
      document.getElementById("newItemMin").value = "";

    }
</script>